<!DOCTYPE html>
<html>
<head>
    <title>MCP API Test</title>
</head>
<body>
    <h1>MCP API Test</h1>
    <button onclick="testAPI()">Test API</button>
    <pre id="output"></pre>
    
    <script>
        async function testAPI() {
            const output = document.getElementById('output');
            try {
                output.textContent = 'Calling API...';
                
                const response = await fetch('http://localhost:3000/api/tools/list_registered_clusters', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });
                
                output.textContent = `Response status: ${response.status}\n`;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                output.textContent += `Raw response:\n${JSON.stringify(data, null, 2)}\n\n`;
                
                // Parse the content
                const textContent = data.content
                    .filter(item => item.type === 'text')
                    .map(item => item.text)
                    .join('');
                
                output.textContent += `Text content:\n${textContent}\n\n`;
                
                // Parse clusters
                const clusters = [];
                const lines = textContent.split('\n');
                
                for (const line of lines) {
                    const match = line.match(/^-\s+([^:]+):\s+([^\s]+)\s+\(([^)]+)\)/);
                    if (match) {
                        clusters.push({
                            name: match[1].trim(),
                            cluster_ip: match[2].trim(),
                            description: match[3].trim()
                        });
                    }
                }
                
                output.textContent += `Parsed clusters:\n${JSON.stringify(clusters, null, 2)}`;
                
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>